@import com.xvygyjau.erkomt.UnstressedDaar

@(phrase: UnstressedDaar)
<html>
<head>
    <style>

@defining("Kranky|Unkempt|Fredericka+the+Great|Emilys+Candy") { fonts =>
@defining(scala.util.Random.shuffle(fonts.replace("+", " ").split('|').toList).head) { font =>

@@import url('https://fonts.googleapis.com/css?family=@{font.replace(" ", "+")}');

.container {
   font-family: '@font', cursive;
}

.styled-select select {
   font-family: '@font', cursive;
}

}}

p {
    font-size: 8vh;
    padding: 5vw;
}

.styled-select {
   background: transparent no-repeat 100% 0;
   overflow: hidden;
   font-size: 8vh;
   overflow: hidden;
}

.styled-select select {
   border: none;
   padding: 0px;
}

@@media screen and (min-width: 601px) {
  .container {
    position: absolute;
    top: 50%;
    left: 50%;
    -moz-transform: translateX(-50%) translateY(-50%);
    -webkit-transform: translateX(-50%) translateY(-50%);
    transform: translateX(-50%) translateY(-50%);
  }
}

@@media screen and (max-width: 600px) {
}
    </style>

    <script>
document.addEventListener('DOMContentLoaded',function() {

    let answerQuality = undefined;
    let answer = undefined;

    document.querySelector('select[id="quiz-select"]').onchange = function (event) {
        answer = event.target.value;
        if (!event.target.value) {
          event.target.style.color = '';
          delete answerQuality;
        }
        @for(opt <- phrase.answer) {
        else if (event.target.value == '@opt') {
          event.target.style.color = 'green';
          answerQuality = true;
        }
        }
        else {
          event.target.style.color = 'red';
          answerQuality = false;
        }
    };

    let last_known_scroll_position = 0;
    let ticking = false;
    let el = document.getElementById('body');

    function action(force) {
        var d = 255 - force
        if (typeof answerQuality == 'undefined') {
            el.style.backgroundColor = 'rgb(' + d + ', ' + d + ', ' + d + ')';
        }
        else if (answerQuality) {
            el.style.backgroundColor = 'rgb(' + d + ', 255, ' + d + ')';
        }
        else {
            el.style.backgroundColor = 'rgb(255, ' + d + ', ' + d + ')';
        }

        if (force > 250 || force > 30 && !isMobileDevice()) {
          setTimeout(function () { loadNewPhrase({ force: force, answer: answer, answerQuality: answerQuality }); }, 1000);
          return true;
        }

        return false;
    }

    window.addEventListener('scroll', function (e) {
        last_known_scroll_position = Math.max(Math.max(-window.scrollY, 0), Math.abs(window.scrollX));

        if (!ticking) {
            window.requestAnimationFrame(function() {
                ticking = action(last_known_scroll_position);
            });

            ticking = true;
        }
    });

},false);

const buildURLQuery = obj =>
    Object.entries(obj)
        .filter(pair => typeof pair[1] !== 'undefined')
        .map(pair => pair.map(encodeURIComponent).join('='))
        .join('&');

function loadNewPhrase(attrs) {
    document.location = "/quiz?" + buildURLQuery(attrs)
}

@* Credits to https://coderwall.com/p/i817wa/one-line-function-to-detect-mobile-devices-with-javascript *@
function isMobileDevice() {
    return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
}
    </script>
    <title>Er komt... '@{phrase.left} __ @{phrase.right}'</title>
</head>
<body id="body">
<div class="container">
    <p>
        @{phrase.left}

        <span id="quiz" class="styled-select">
        <select id="quiz-select" class="styled-select">
            <option value="">__</option>
            @for(opt <- phrase.quiz) {
            <option value="@opt">@opt</option>
            }
        </select>
        </span>

        @{phrase.right}
    </p>
</div>
</body>
</html>
